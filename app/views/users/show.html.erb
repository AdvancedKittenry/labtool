<p id="notice"><%= notice %></p>

<h1> <%= "#{@user.forename} #{@user.surename}" %> </h1>

<div style="background: #cccccc; padding: 5px;">

  <p>
    <b>Student number:</b>
    <%= @user.student_number %>
  </p>

  <p>
    <b>Email:</b>
    <%= @user.email %>
  </p>

</div>


<% if @user.current_registration %>

    <h2>Current work</h2>

    <div class="rounded">


      <div>
        <p><%= @user.current_registration.topic %></p>

        <p><%= link_to @user.current_registration.repository, @user.current_registration.repository %></p>
      </div>

      <h3>Weekly feedbacks</h3>

      <table>
        <tr>
          <% (1..6).each do |week| %>
              <th style="width: 50px"> <%= week %></th>
          <% end %>
        </tr>
        <tr>
          <% (1..6).each do |week| %>
              <td style="width: 50px; ; text-align: center;"> <%= @user.current_registration.points_for_week week %></td>
          <% end %>
        </tr>
      </table>

      <% if @user.current_registration.feedback.size > 0 %>
          <h3 class="button" id="review">Show weekly feedbacks</h3>
      <% end %>

      <div class="reviews">
        <ul>
          <% @user.current_registration.feedback.each do |fb| %>
              <li><%= "week: #{fb.week}, points: #{fb.points}, comments:" %>
                <pre><%= fb.text %></pre>
              </li>
          <% end %>
        </ul>
      </div>

      <h4 class="button" id="review-form">Give a new or edit feedback</h4>

      <div class="review-form">
        <%= form_tag("/week_feedbacks") do -%>
            <%= label_tag 'week' %>
            <br/>
            <%= text_field_tag 'week_feedback[week]', @user.current_registration.course.week %>
            <br/>
            <%= label_tag 'points' %>
            <br/>
            <%= text_field_tag 'week_feedback[points]' %>
            <br/>
            <%= label_tag 'comments' %>
            <br/>
            <%= text_area_tag 'week_feedback[text]', nil, :size => "100x10" %>
            <br/>
            <%= label_tag 'notify by email' %>
            <%= check_box_tag 'notify', true, true %>
            <br/>
            <br/>
            <%= hidden_field_tag :registration, @user.current_registration.id %>
            <%= submit_tag 'Save' %>
        <% end -%>
      </div>

    </div>


    <h2>Code reviews</h2>

    <div class="rounded">

      <h3>round 1</h3>

      <p><%= "participate review 1: #{(@user.current_registration.participates_review 1) ? "yes" :"no"}" %></p>

      <% if @user.assigned_reviews_in(1).count>0 %>

          <h4>Code to review</h4>

          <% @user.assigned_reviews_in(1).each do |review| %>
              <%= link_to review.reviewed.repository, review.reviewed.repository %>
              <% if not review.done %>
                  <em>not done</em>

              <% else %>
                  <em>reviewed</em>
              <% end %>

          <% end %>
      <% else %>
          <h4>No code assigned for review yet</h4>
      <% end %>

      <% if @user.assigned_reviewers_in(1).count>0 %>

          <h4>Reviewers</h4>

          <% @user.assigned_reviewers_in(1).each do |review| %>
              <%= link_to(review.reviewer.user, review.reviewer.repository) %>
              <em><%= review.done() ? "ready" :"not done yet" %></em>
              <br/>
          <% end %>
      <% else %>
          <h4>Nobody assigned to review your code yet</h4>
      <% end %>


      <h3>round 2</h3>

       <p><%= "participate review 2: #{(@user.current_registration.participates_review 1) ? "yes" :"no"}" %></p>

       <% if @user.assigned_reviews_in(2).count>0 %>

           <h4>Code to review</h4>

           <% @user.assigned_reviews_in(2).each do |review| %>
               <%= link_to review.reviewed.repository, review.reviewed.repository %>
               <% if not review.done %>
                   <em>not done</em>

               <% else %>
                   <em>reviewed</em>
               <% end %>

           <% end %>
       <% else %>
           <h4>No code assigned for review yet</h4>
       <% end %>

       <% if @user.assigned_reviewers_in(2).count>0 %>

           <h4>Reviewers</h4>

           <% @user.assigned_reviewers_in(2).each do |review| %>
               <%= link_to(review.reviewer.user, review.reviewer.repository) %>
               <em><%= review.done() ? "ready" :"not done yet" %></em>
               <br/>
           <% end %>
       <% else %>
           <h4>Nobody assigned to review your code yet</h4>
       <% end %>

    </div>



<% end %>


<br/>

<% if @user.past_registrations.count>0 %>
    <div style="background: #cccccc; padding: 5px;"><h2>Past registrations</h2></div>

    <div class="rounded">

      <% @user.past_registrations.each do |r| %>
          <div>
            <h4><%= r.course %></h4>

            <p><%= r.topic %></p>

            <p><%= link_to r.repository, r.repository %></p>
          </div>

          <div>
            <ul>
              <% r.week_feedbacks.each do |fb| %>
                  <li><%= "week: #{fb.week}, points: #{fb.points}, comments: #{fb.text}" %></li>
              <% end %>
            </ul>
          </div>
      <% end %>

    </div>
<% end %>


<%= link_to 'Drop from current course', @user.current_registration, method: :delete, data: {confirm: 'Are you sure?'}, :class => 'small-button' %>
<%= link_to 'Edit', edit_user_path(@user), :class => 'small-button' %>