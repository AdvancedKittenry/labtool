<p id="notice"><%= notice %></p>

<h2> <%= "#{@user.forename} #{@user.surename}" %> </h2>

<p>
  <b>Student number:</b>
  <%= @user.student_number %>
</p>

<p>
  <b>Email:</b>
  <%= @user.email %>
</p>

<h3>Current work:</h3>
<div>
  <p><%= @user.current_registration.topic %></p>

  <p><%= link_to @user.current_registration.repository, @user.current_registration.repository %></p>
</div>

<% if @user.current_registration.feedback.size > 0 %>
<h4 class="button" id="review">Show weekly reviews</h4>
<% end %>

<div class="reviews">
  <ul>
    <% @user.current_registration.feedback.each do |fb| %>
        <li><%= "week: #{fb.week}, points: #{fb.points}, comments:" %>
           <pre><%= fb.text %></pre>
        </li>
    <% end %>
  </ul>
</div>

<h4 class="button" id="review-form">Give a new feedback</h4>

<div class="review-form">
  <%= form_tag("/week_feedbacks") do -%>
      <%= label_tag 'week' %>
      <br/>
      <%= text_field_tag 'week_feedback[week]' %>
      <br/>
      <%= label_tag 'points' %>
      <br/>
      <%= text_field_tag 'week_feedback[points]' %>
      <br/>
      <%= label_tag 'comments' %>
      <br/>
      <%= text_area_tag 'week_feedback[text]', nil, :size => "100x10" %>
      <br/>
      <%= hidden_field :registration, @user.current_registration.id %>
      <%= submit_tag 'Save' %>
  <% end -%>
</div>

<%= link_to 'Drop from course', @user.current_registration, method: :delete, data: {confirm: 'Are you sure?'} %>

<br/>

<% if @user.past_registrations.count>0 %>
    <h3>Past registrations:</h3>
    <% @user.past_registrations.each do |r| %>
        <div>
          <h4><%= r.course %></h4>

          <p><%= r.topic %></p>

          <p><%= link_to r.repository, r.repository %></p>
        </div>

        <div>
          <ul>
            <% r.week_feedbacks.each do |fb| %>
                <li><%= "week: #{fb.week}, points: #{fb.points}, comments: #{fb.text}" %></li>
            <% end %>
          </ul>
        </div>
    <% end %>
<% end %>


<%= link_to 'Edit', edit_user_path(@user) %> |
<%= link_to 'Back', users_path %>
