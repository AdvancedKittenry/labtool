<h1>Assign peer reviews for students</h1>

<h3>Course: <%= @course %></h3>

<% if @course.review_round==0 %>

    <h4>reviews not started</h4>

<% elsif @course.review_round>2 %>

    <h4>reviews completed</h4>

<% else%>

<h4>review round <%= @course.review_round %></h4>

<p>Rows represent reviewers and columns targets of review</p>

<table>
  <tr class="bar">
    <th></th>
    <% @students.each do |student| %>
        <% if student.assigned_reviewers.count>1 %>
            <th id='<%= "r#{student.id}"%>' class='many-reviewers-assigned rotate'><%= student %></th>
        <% elsif student.assigned_reviewers.count>0 %>
            <th id='<%= "r#{student.id}"%>' class='review-assigned rotate'><%= student %></th>
        <% else %>
            <th id='<%= "r#{student.id}"%>' class='rotate'><%= student %></th>
        <% end %>
    <% end %>
  </tr>

  <% @students.each do |student| %>
      <tr>
        <% if student.assigned_reviews.count>1 %>
            <td id='<%= "s#{student.id}"%>' class='<%="many-reviews-assigned" %>' ><%= link_to student, student %></td>
        <% elsif student.assigned_reviews.count>0 %>
            <td id='<%= "s#{student.id}"%>' class='<%="review-assigned" %>' ><%= link_to student, student %></td>
        <% else %>
            <td id='<%= "s#{student.id}"%>' ><%= link_to student, student %></td>
        <% end %>

        <% @students.each do |reviewed| %>
            <td id='<%= "b#{student.id}-#{reviewed.id}"%>'
                class='<%= student.assigned_to_review reviewed %>'>
            <% if student.id!=reviewed.id %>
                <%= form_tag('/toggle_review', :remote => true) do %>
                  <%= hidden_field_tag 'reviewer', student.id %>
                  <%= hidden_field_tag 'reviewed', reviewed.id %>
                  <%= submit_tag student.assigned_to_review reviewed  %>
                <% end %>

            <% end %>
            </td>

        <% end %>
      </tr>
  <% end %>
<% end %>



</table>